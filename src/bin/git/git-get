#!/bin/bash

usage() {
  echo "Usage: $(basename "$0") [-h|-b|-n|-r]"
  echo "-b: branch"
  echo "-n: name"
  echo "-r: root"
}
action=
while getopts "hbnr" arg; do
  case $arg in
    h)
      usage
      exit 0
    ;;
    b)
      if [[ -n "$action" ]] && [[ "$action" != "branch" ]]; then
        echo.error "[-b|-n|-r] are mutually exclusive"
        exit 1
      fi
      action=branch
    ;;
    n)
      if [[ -n "$action" ]] && [[ "$action" != "name" ]]; then
        echo.error "[-b|-n|-r] are mutually exclusive"
        exit 1
      fi
      action=name
    ;;
    r)
      if [[ -n "$action" ]] && [[ "$action" != "root" ]]; then
        echo.error "[-b|-n|-r] are mutually exclusive"
        exit 1
      fi
      action=root
    ;;
    *)
      usage
      exit 1
    ;;
  esac
done

shift $((OPTIND - 1))
if [[ $# -ne 0 ]]; then
  usage
  exit 0
fi
if [[ -z "$action" ]]; then
  usage
  exit 0
fi

if [[ "$action" == "branch" ]]; then

  git branch 2>/dev/null | sed -e '/^[^*]/d' -e 's/* \(.*\)/\1/'

  elif [[ "$action" == "name" ]]; then

  basename "$(git remote get-url origin 2>/dev/null)"

  elif [[ "$action" == "root" ]]; then

  git rev-parse --show-toplevel
fi
